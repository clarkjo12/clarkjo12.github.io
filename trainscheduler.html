<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Da Train Scheduler</title>

  <!-- Added link to the jQuery Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <!-- Added a link to Bootstrap-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    
  <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
  <!-- Moment.js Reference -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/5.5.7/firebase-app.js"></script>
    
    
</head>
<body>

  <div class="jumbotron">
    <h1 class="text-center">Train Scheduler</h1>
  </div>

  <div class="container">

    <div class="col">

      

      <!-- Result Card -->
      <div class="row-lg-6">
        <div class="card">
          <h3 class="card-header text-center">Add a Train:</h3>
          <div class="card-body">
            
              <div class="row">
                  
              
                <div class="col">
                 <input type="text" class="form-control" placeholder="Train Name" id="trainName"> 
                </div>
                <div class="col">
                  <input type="text" class="form-control" placeholder="Destination" id="destination">
                </div>
                <div class="col">
                  <input type="text" class="form-control" placeholder="1st time-hh:mm" id="firstTime">
                </div>
                <div class="col">
                  <input type="text" class="form-control" placeholder="Frequecy" id="frequency">
                </div>
                <div class="col-auto">
                <button id="buttonAdd" type="submit" class="btn btn-primary mb-2">Add!</button>
                </div>
               </div>
            </div>       
          </div>
        </div>
        
        
        
        
        <div class="row-lg-6">
            <div class="card">
                    <h3 class="card-header text-center">Current Schedule:</h3>
            <div class="card-body">
             <table class="table" id="train-table">
  <thead>
    <tr>
      <th scope="col">Train</th>
      <th scope="col">Destination</th>
      <th scope="col">First Train</th>
      <th scope="col">Frequency</th>
      <th scope="col">Next Train..</th>
      <th scope="col">..Minutes Till</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      
    
    </tr>
    
  </tbody>
</table>
              
          </div>
       </div>       
     </div>
  </div>
</div>
   
    
    
    <script src="https://www.gstatic.com/firebasejs/5.5.7/firebase.js"></script>
    <script>
    
var config = {
    apiKey: "AIzaSyBw0PryFhd4Qn3Nwc35efHXc3qy-487zsA",
    authDomain: "bootcamp-674ba.firebaseapp.com",
    databaseURL: "https://bootcamp-674ba.firebaseio.com",
    projectId: "bootcamp-674ba",
    storageBucket: "bootcamp-674ba.appspot.com",
    messagingSenderId: "118225152767"
  };
    
        firebase.initializeApp(config);
        
        
       var dataRef = firebase.database();
//    
//
//        


$("#buttonAdd").click(function(){
    
    var trainsName = document.getElementById('trainName').value.trim();
    console.log(trainsName);
    
     var trainsDest = document.getElementById('destination').value.trim();
    console.log(trainsDest);
    
     var trainsFirst = document.getElementById('firstTime').value.trim();
    console.log(trainsFirst);
    
     var trainsFreq = document.getElementById('frequency').value.trim();
    console.log(trainsFreq);
    
    
    
                   
    
    dataRef.ref().push({
        name: trainsName,
        dest: trainsDest,
        ftime: trainsFirst,
        freq: trainsFreq,
        
        dateAdded: firebase.database.ServerValue.TIMESTAMP
      });


    $("#trainName").val("");
  $("#destination").val("");
  $("#firstTime").val("");
  $("#frequency").val("");
    
}); 
        

        dataRef.ref().on("child_added", function(snapshot) {
            
            
           var trainName = snapshot.val().name;
           var trainFreq = snapshot.val().freq;
           var trainDest = snapshot.val().dest;
           var trainFtime = snapshot.val().ftime;
          
            
               // Current Time
            var firstTimeConverted = moment(trainFtime, "HH:mm").subtract(1, "years");
                console.log(firstTimeConverted);
    
            
                    var currentTime = moment();
                    console.log("CURRENT TIME: " + moment(currentTime).format("hh:mm"));

                    // Difference between the times
                    var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
                    console.log("DIFFERENCE IN TIME: " + diffTime);

                    // Time apart (remainder)
                    var tRemainder = diffTime % trainFreq;
                    console.log(tRemainder);

                    // Minute Until Train
                    var trainTill = trainFreq - tRemainder;
                    console.log("MINUTES TILL TRAIN: " + trainTill);

                    // Next Train
                    var trainNext = moment().add(trainTill, "minutes");
                    var trainNext = moment(trainNext).format("hh:mm");
    

            
            // Create the new row
  var newRow = $("<tr>").append(
    $("<td>").text(trainName),
    $("<td>").text(trainDest),
    $("<td>").text(trainFtime),
    $("<td>").text(trainFreq),
    $("<td>").text(trainNext),
   $("<td>").text(trainTill)
  );

  // Append the new row to the table
  $("#train-table > tbody").append(newRow);
            
        }, function(errorObject) {
      console.log("The read failed: " + errorObject.code);
    });
                        
        
       
        
        
        
  function createRow(data) {
    var tRow = $("<tr>");  
  }
</script>

  <script type="text/javascript">
      
    var weather = require("weather-js");
      
    weather.find({ search: "Camden, NY", degreeType: "F"}, function(err, result) {
        
        if (err){
            console.log(err);
        }
        console.log(JSON.stringify(result, null,2));
    })
      

    $(document).ready(function() {   
        
    });
      
      

</script>
    
<script src="https://www.gstatic.com/firebasejs/5.5.7/firebase.js"></script>

</body>
</html>
